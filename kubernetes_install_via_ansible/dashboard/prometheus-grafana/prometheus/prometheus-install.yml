- name: download helm package
  hosts: localhost
  vars:
    download_url: "https://get.helm.sh/helm-v3.2.3-linux-arm64.tar.gz"
    download_location: "{{ playbook_dir }}"
    helm_file: helm.taz.gaz
  tasks:
    - name: install tar module if not installed
      become: yes
      yum:
        name: unzip
        state: present

    - name: download helm from internet
      get_url:
        url: "{{ download_url }}"
        dest: "{{ download_location }}/{{ helm_file }}"
        mode: 0755
    - name: Extracting {{helm_file}} to {{ download_location }}
      unarchive:
        src: "{{ helm_file }}"
        dest: "{{ playbook_dir }}/{{ helm_file | basename }}"

- hosts: master
  vars:
    remote_direcotry: /usr/local/bin/helm
  tasks:
    - name: moving {{ helm_file }} to remote host {{ ansible_host }}/{{ remote_directory }}/helm
      become: yes
      copy:
        src: helm/linux-amd64/helm
        dest: /usr/local/bin/helm
